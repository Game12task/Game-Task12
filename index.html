<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ù‡Ø§Ù… Ù„ÙƒØ³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±Ø§Øª - GameTask</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #121212; color: #E0E0E0; margin:0; padding:0; text-align:center;}
        .container { max-width:600px; margin:50px auto; padding:20px; background-color:#1E1E1E; border-radius:15px; box-shadow:0 4px 25px rgba(0,0,0,0.7);}
        h1 { color:#64ffda; font-size:26px; margin-bottom:20px; border-bottom:2px solid rgba(100,255,218,0.2); padding-bottom:10px;}
        .user-input { background-color:#2C2C2C; padding:20px; border-radius:10px; margin-bottom:25px; text-align:right; border:1px solid #64ffda;}
        .user-input label { color:#E0E0E0; display:block; margin-bottom:8px; font-size:14px;}
        .user-input input { width:100%; padding:12px; border-radius:8px; border:none; background-color:#3A3A3A; color:#FFFFFF; box-sizing:border-box; text-align:right; font-size:16px;}
        .balance-section { background-color:#333333; padding:15px; border-radius:10px; margin-bottom:25px; text-align:center; border:2px solid #FFD700;} /* Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· */
        .balance-section p { margin:0; font-size:18px; color:#FFD700;}
        #balance-display { font-size:32px; font-weight:bold; color:#00FF7F; margin-top:5px;} /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ù‚Ø§Ø· */
        .offer-section { background-color:#2C2C2C; padding:15px 0; border-radius:10px; margin-bottom:25px; border:1px solid #3A3A3A; overflow:hidden;}
        .offer-header { color:#FFD700; font-size:20px; margin-bottom:15px; text-align:center; padding-bottom:10px; border-bottom:1px solid rgba(255,215,0,0.2);}
        #cpa-offer-wall-container { min-height:500px;}
    </style>
</head>
<body>

<div class="container">
    <h1>Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ù‡Ø§Ù… Ù„ÙƒØ³Ø¨ Ø§Ù„Ù…Ø§Ù„ (Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±)</h1>

    <div class="balance-section">
        <p>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±Ø§Øª (Ù†Ù‚Ø§Ø·):</p>
        <div id="balance-display">--.--</div>
    </div>
    <div class="user-input">
        <label for="username-input">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·):</label>
        <input type="text" id="username-input" placeholder="Ù…Ø«Ø§Ù„: Ahmad123">
        <p id="message-area" style="color:red; margin-top:10px; text-align:center; font-weight:bold;"></p>
    </div>

    <div class="offer-section">
        <div class="offer-header">ğŸ‘‘ GAME TASK ğŸ‘‘ | Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</div> 
        <div id="cpa-offer-wall-container">
            <p style="text-align:center; color:#ffeb3b; padding:20px;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨.</p>
        </div>
    </div>
</div>

<script>
    // ********* 1. ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ *********
    const API_URL = 'https://script.google.com/macros/s/AKfycbxxNL_pYhNfNak9DL6Zj3sVgENzeOvP1XaKgIke5_1_k5aCVnpwlntZY-0ilu8-7y6t/exec';
    // **********************************************
    
    const usernameInput = document.getElementById('username-input');
    const cpaContainer = document.getElementById('cpa-offer-wall-container'); 
    const balanceDisplay = document.getElementById('balance-display'); // Ø¹Ù†ØµØ± Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø·
    const messageArea = document.getElementById('message-area');

    // Ø±Ø§Ø¨Ø· Ø¬Ø¯Ø§Ø± CPX Research - ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ± 'app_id=29908' Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù€ ID Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø°ÙŠ Ø­ÙØ¸Øª Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙ‡ Ø§Ù„Ø¢Ù†
    // (Ø¥Ø°Ø§ ÙƒÙ†Øª Ù‚Ø¯ Ø­Ø°ÙØª 29908ØŒ Ø§Ø³ØªØ®Ø¯Ù… ID Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯)
    const CPA_OFFERWALL_BASE_URL = 'https://offers.cpx-research.com/index.php?app_id=29908&ext_user_id={USER_ID}&secure_hash=abcde12345&username={USER_NAME}&email=test@example.com';

    // ********** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø¬Ù„Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª **********
    async function fetchBalance(userID) {
        try {
            const url = `${API_URL}?action=getBalance&id=${userID}`;
            const response = await fetch(url);
            const data = await response.json();

            if (data.status === 'success') {
                balanceDisplay.textContent = parseFloat(data.balance).toFixed(2) + ' $'; // Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¯ÙˆÙ„Ø§Ø±ÙŠÙ†
            } else {
                balanceDisplay.textContent = 'Ø®Ø·Ø£';
            }
        } catch (error) {
            console.error('Error fetching balance:', error);
            balanceDisplay.textContent = 'Ø®Ø·Ø£ Ø§ØªØµØ§Ù„';
        }
    }
    // ***************************************************************

    function updateOfferwall(userID, username) {
        if (cpaContainer) {
            const offerwallSrc = CPA_OFFERWALL_BASE_URL
                                    .replace('{USER_ID}', userID)
                                    .replace('{USER_NAME}', encodeURIComponent(username));
            const iframeCode = `
                <iframe 
                    sandbox='allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation allow-popups-to-escape-sandbox' 
                    src='${offerwallSrc}' 
                    style='width:100%; height:2000px; border:none; display:block;' 
                    frameborder='0'>
                </iframe>
            `;
            cpaContainer.innerHTML = iframeCode;
        }
        fetchBalance(userID); // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙˆØ±Ø§Ù‹
    }

    // ********** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª **********
    async function registerUser(username) {
        messageArea.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
        const url = `${API_URL}?action=addUser&name=${encodeURIComponent(username)}`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            if (data.status === 'success') {
                const newUserID = data.ID;
                localStorage.setItem('userID', newUserID);
                localStorage.setItem('username', username);
                usernameInput.disabled = true;
                messageArea.textContent = 'ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ID: ' + newUserID;
                messageArea.style.color = '#00FF7F'; // Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø¬Ø§Ø­
                updateOfferwall(newUserID, username);
            } else {
                // Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø®Ø·Ø£ Ù‡Ùˆ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹
                messageArea.textContent = data.message || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. Ø­Ø§ÙˆÙ„ Ø¨Ø§Ø³Ù… Ø¢Ø®Ø±.';
                messageArea.style.color = 'red';
                usernameInput.disabled = false;
            }
        } catch (error) {
            messageArea.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….';
            messageArea.style.color = 'red';
            console.error('Error registering user:', error);
            usernameInput.disabled = false;
        }
    }
    // *******************************************************************

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø®Ø²Ù† Ù…Ø³Ø¨Ù‚Ø§Ù‹
    let currentUserID = localStorage.getItem('userID');
    let currentUsername = localStorage.getItem('username');
    if(currentUserID && currentUsername){
        usernameInput.value = currentUsername;
        usernameInput.disabled = true;
        updateOfferwall(currentUserID, currentUsername);
    }

    // Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    usernameInput.addEventListener('change', () => {
        const newUsername = usernameInput.value.trim();
        if(newUsername){
            registerUser(newUsername);
        }
    });
</script>

</body>
</html>
