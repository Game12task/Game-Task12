<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Game Task â€” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDuQsN4n3In6arYu0wkw9gC...", // Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
      authDomain: "mytasktracker-59e00.firebaseapp.com",
      projectId: "mytasktracker-59e00",
      storageBucket: "mytasktracker-59e00.appspot.com",
      messagingSenderId: "433007982533",
      appId: "1:433007982533:web:99e74c7fa4f0c401d77a06",
      measurementId: "G-RDZB0YQJNP"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase ÙˆØªØ¬Ù‡ÙŠØ² Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(); 
    const usersCollection = db.collection('users'); // ØªØ¹Ø±ÙŠÙ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
</script>
<style>
/* -------------------------------------- */
/* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (CSS) - Ù„Ù… ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ */
/* -------------------------------------- */
:root{
  --bg:#0b1220; --card:#071227; --accent:#06b6d4; --muted:#94a3b8; --gold:#d4af37;
}
*{box-sizing:border-box;font-family:"Segoe UI",Tahoma,"Noto Kufi Arabic",system-ui,sans-serif;}
body{margin:0;background:linear-gradient(180deg,#071127 0%, #071a2a 100%);color:#e6eef6;padding:20px;}
header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:18px;}
.brand{display:flex;align-items:center;gap:12px;}
.logo{width:54px;height:54px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#0891b2);display:flex;align-items:center;justify-content:center;font-weight:700;}
h1{margin:0;font-size:20px;}
p.lead{margin:0;color:var(--muted);font-size:13px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:18px;}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:10px;min-height:160px;transition:transform 0.2s,box-shadow 0.2s;cursor:pointer;}
.card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.4);}
.title{font-weight:700;font-size:16px;}
.desc{color:var(--muted);font-size:13px;}
.meta{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:auto;}
.btn{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700;}
.open-btn{background:linear-gradient(90deg,var(--accent),#0891b2);color:#022;text-decoration:none;display:inline-block;text-align:center;width:100%;}
.gold-card{background:linear-gradient(180deg,rgba(212,175,55,0.2),rgba(212,175,55,0.1));border:1px solid rgba(212,175,55,0.6);}
.gold-card .title{color:var(--gold);}
.gold-card .counter{font-size:14px;color:var(--gold);font-weight:700;margin-bottom:10px;}
footer{margin-top:22px;color:var(--muted);font-size:13px;text-align:center;}
.section-title{font-size:18px;font-weight:700;margin-bottom:10px;color:var(--accent);}
.subgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;}
.external-complete-btn {
    background-color: #4CAF50 !important; 
    color: #022 !important;
}
.survey-content {
    display: none;
    padding: 10px;
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-top: 10px;
}
.survey-card {
    cursor: pointer;
    background: linear-gradient(180deg, rgba(6,182,212,0.1), rgba(6,182,212,0.05));
    border-color: rgba(6,182,212,0.3);
}
.survey-progress {
    color: var(--gold);
    font-weight: 700;
    margin-bottom: 10px;
}
/* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ†Ù‚Ù„ */
.nav-card {
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
    border: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
    min-height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-decoration: none;
}
.nav-card .icon {
    font-size: 24px;
    margin-bottom: 5px;
}

input, textarea{width:100%;padding:8px;border-radius:6px;border:none;margin-bottom:10px;}
button.send-btn{background:var(--accent);color:#022;padding:10px;border-radius:8px;border:0;cursor:pointer;font-weight:700;width:100%;}
</style>
</head>
<body>

<div id="auth-section">
    <h1>ØªØ³Ø¬ÙŠÙ„/Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h1>
    <label for="username">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:</label><br>
    <input type="text" id="username" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ Ø³ØªØ³ØªØ®Ø¯Ù…Ù‡"><br><br>
    <button onclick="handleAuth()">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„ ÙÙˆØ±ÙŠ</button>
    <p id="message" style="color: yellow;"></p>
</div>

<div id="dashboard-section" style="
    display:none; 
    padding: 15px; 
    background-color: #0b1220; 
    border-bottom: 2px solid #071227;
    margin-bottom: 20px;
    color: white;
">
    <h3 id="user-display" style="margin: 0;"></h3>
</div>

<main id="main-content" style="display:none;">
  <header>
    <div class="brand">
      <div class="logo">GT</div>
      <div>
        <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
        <p class="lead">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªØ¨Ø¯Ø£ Ø§Ù„ÙƒØ³Ø¨.</p>
      </div>
    </div>
  </header>
  
  <h2 class="section-title" style="margin-top: 25px;">Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
  
  <div class="subgrid">
      <a href="task_categories.html" class="card nav-card">
          <div class="icon">â­</div>
          <div class="title">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
      </a>
      
      <a href="index.html" class="card nav-card">
          <div class="icon">ğŸ’°</div>
          <div class="title">Ø¹Ø±ÙˆØ¶ ÙˆÙ…Ù‡Ø§Ù… Ø®Ø§Ø±Ø¬ÙŠØ©</div>
      </a>
      
      <a href="surveys.html" class="card nav-card survey-card">
          <div class="icon">ğŸ“Š</div>
          <div class="title">Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø£ÙŠ</div>
      </a>
  </div>


  <a href="offers.html" style="text-decoration: none; margin-top: 20px; display: block;">
      <div class="card gold-card" id="goldCard" style="display:flex;">
          <div class="title">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
          <div class="counter" id="pointsCounter">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
          <div class="desc">Ø§Ø¶ØºØ· Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø·.</div>
      </div>
  </a>
  
  <div style="margin-bottom:20px; text-align:center;">
    <p style="color:var(--muted);">Ø¥Ø¹Ù„Ø§Ù† Google</p>
  </div>
  
  <div style="margin-top:30px;">
      <h2 class="section-title">Ø£Ø´Ù‡Ø± Ù…Ù†ØµØ§Øª Ø§Ù„ÙƒØ³Ø¨</h2>
      <div class="grid" id="cardsGrid">
        <div class="card">
          <div class="title">Freecash â€” Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ù‡Ø§Ù…</div>
          <div class="desc">Ø§ÙƒÙ…Ù„ Ø¹Ø±ÙˆØ¶ ÙˆØ§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·.</div>
          <div class="meta">
            <a class="btn open-btn" href="https://freecash.com/r/ST6JL" target="_blank" rel="noopener noreferrer">Ø§Ø°Ù‡Ø¨</a>
          </div>
        </div>
        <div class="card">
          <div class="title">PrizeRebel â€” Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ù‡Ø§Ù…</div>
          <div class="desc">Ø³Ø¬Ù„ ÙˆØ§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ø¹Ø±ÙˆØ¶Ø› ØºØ§Ù„Ø¨Ù‹Ø§ ØªØ¹Ø·ÙŠ Ù†Ù‚Ø§Ø· Ø¬ÙŠØ¯Ø©.</div>
          <div class="meta">
            <a class="btn open-btn" href="https://www.prizerebel.com/index.php?r=16156361" target="_blank" rel="noopener noreferrer">Ø§Ø°Ù‡Ø¨</a>
          </div>
        </div>
        </div>
  </div>


  <div style="margin-top:30px;">
    <h2 class="section-title">Ù…Ù† Ù†Ø­Ù†</h2>
    <p style="color:var(--muted);">Game Task Ù‡Ùˆ Ù…ÙˆÙ‚Ø¹ ÙŠÙ‚Ø¯Ù… Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ù‡Ù…Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§Ø±ØŒ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ù†Ø´Ø§Ø·Ù‡Ù…. Ù‡Ø¯ÙÙ†Ø§ Ù‡Ùˆ ØªÙ‚Ø¯ÙŠÙ… Ù…Ø­ØªÙˆÙ‰ Ù…ØªÙ†ÙˆØ¹ ÙˆÙ…Ù…ØªØ¹ ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„ØªØ±ÙÙŠÙ‡.</p>
  </div>
  
  <div style="margin-top:20px;">
    <h2 class="section-title">Ø§ØªØµÙ„ Ø¨Ù†Ø§</h2>
    <form id="contactForm">
      <input type="text" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
      <input type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
      <textarea placeholder="Ø±Ø³Ø§Ù„ØªÙƒ" rows="4" required></textarea>
      <button type="submit" class="send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
    </form>
  </div>
</main>

<footer>
  Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Google AdSense ÙÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª.
</footer>

<script>
  // Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
  document.getElementById('contactForm').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!');
    this.reset();
  });
</script>

<script>
    // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¯Ø®ÙˆÙ„
    async function handleAuth() {
        const usernameInput = document.getElementById('username').value.trim();
        const messageElement = document.getElementById('message');
        
        if (!usernameInput) {
            messageElement.textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù….";
            return;
        }

        // 1. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø§Ø³Ù…
        const querySnapshot = await usersCollection.where('username', '==', usernameInput).get();

        if (querySnapshot.empty) {
            // --- (Ø£) Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯: ØªØ³Ø¬ÙŠÙ„ ÙÙˆØ±ÙŠ ---
            try {
                const newUserRef = await usersCollection.add({
                    username: usernameInput,
                    points: 0
                });
                const newUserId = newUserRef.id; 
                // Ø­ÙØ¸ Ø§Ù„Ø¢ÙŠØ¯ÙŠ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
                localStorage.setItem('user_id', newUserId); 
                displayDashboard(usernameInput, newUserId, 0);
                messageElement.textContent = `ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ùˆ: ${newUserId}`;
            } catch (error) {
                messageElement.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.";
            }
        } else {
            // --- (Ø¨) Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¦Ø¯: ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ---
            const userData = querySnapshot.docs[0].data();
            const userId = querySnapshot.docs[0].id;
            // Ø­ÙØ¸ Ø§Ù„Ø¢ÙŠØ¯ÙŠ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
            localStorage.setItem('user_id', userId); 
            displayDashboard(userData.username, userId, userData.points);
            messageElement.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ÙŠØ§ ${userData.username}`;
        }
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø¢ÙŠØ¯ÙŠ
    function displayDashboard(username, userId, points) {
        // Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('auth-section').style.display = 'none';
        // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ¯ÙŠ
        document.getElementById('dashboard-section').style.display = 'block';
        
        // **Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª Ù…Ø®ÙÙŠØ©)**
        document.getElementById('main-content').style.display = 'block'; 
        
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ·
        const userDisplay = document.getElementById('user-display');
        userDisplay.innerHTML = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ ${username} | <b>Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userId}</b> | Ø§Ù„Ù†Ù‚Ø§Ø·: ${points}`;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©)
        const pointsCounter = document.getElementById('pointsCounter');
        if (pointsCounter) {
            pointsCounter.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${points}`;
        }
    }
    
    // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = function() {
        const storedUserId = localStorage.getItem('user_id');
        if (storedUserId) {
            usersCollection.doc(storedUserId).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    displayDashboard(userData.username, storedUserId, userData.points);
                } else {
                    document.getElementById('auth-section').style.display = 'block';
                }
            }).catch(error => {
                document.getElementById('auth-section').style.display = 'block';
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:", error);
            });
        } else {
            document.getElementById('auth-section').style.display = 'block';
        }
    }
</script>
</body>
</html>
