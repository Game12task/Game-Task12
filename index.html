<div class="container">
    <h1>مركز المهام لكسب المال (الدولار)</h1>

    <div class="user-input">
        <label for="username-input">الرجاء إدخال اسم المستخدم الخاص بك (مرة واحدة فقط):</label>
        <input type="text" id="username-input" placeholder="مثال: Ahmad123">
    </div>

    <!-- شبكة البطاقات -->
    <div id="cpa-cards" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px;"></div>

    <div class="bitlabs-container">
        <div class="bitlabs-header">استطلاعات الرأي الكبرى (BitLabs) 🧠</div>
        <div class="closed-section-message">
            قسم الاستطلاعات قيد التحديث والإعداد حالياً. نعتذر للإزعاج!
        </div>
        <button id="bitlabs-btn" onclick="openBitLabs()">ابدأ الاستبيانات</button>
    </div>
</div>

<script type='text/javascript' src='https://akamaicdn.org/js/offerwall.js'></script>
<script>
const tasks = [
    {title:"مهمة 1", description:"أكمل العرض لتحصل على مكافأتك", offerID:"4q9Fm"},
    {title:"مهمة 2", description:"سجل في الموقع واحصل على نقاط", offerID:"4q9Fm"},
    {title:"مهمة 3", description:"جرب التطبيق واحصل على مكافأة", offerID:"4q9Fm"}
];

// التعامل مع اسم المستخدم
let userID = localStorage.getItem('userID');
if(!userID){
    userID = prompt("أدخل اسم المستخدم الخاص بك:");
    localStorage.setItem('userID', userID);
}
document.getElementById('username-input').value = userID;
document.getElementById('username-input').disabled = true;

// إنشاء البطاقات
const container = document.getElementById('cpa-cards');
tasks.forEach(task=>{
    const card = document.createElement('div');
    card.style.background="#2C2C2C";
    card.style.padding="15px";
    card.style.borderRadius="12px";
    card.style.boxShadow="0 4px 20px rgba(0,0,0,0.7)";
    card.innerHTML = `
        <h3 style="color:#FFD700;">${task.title}</h3>
        <p style="color:#E0E0E0;">${task.description}</p>
        <iframe id="iframe-${task.offerID}" style="width:100%; height:350px; border:none; border-radius:8px; margin-bottom:10px;"></iframe>
        <button style="background:#64ffda;color:#121212;border:none;border-radius:8px;padding:10px 20px;margin:5px;cursor:pointer;font-weight:bold;"
            onclick="loadOfferInIframe('${task.offerID}','${userID}')">تحميل العرض داخل البطاقة</button>
        <button style="background:#64ffda;color:#121212;border:none;border-radius:8px;padding:10px 20px;margin:5px;cursor:pointer;font-weight:bold;"
            onclick="openOfferInNewWindow('${task.offerID}','${userID}')">فتح العرض في نافذة جديدة</button>
    `;
    container.appendChild(card);
});

// دوال التحميل والفتح
function loadOfferInIframe(offerID, userID){
    const iframe = document.getElementById('iframe-'+offerID);
    const url = `https://www.directcpi.com/list/${offerID}?subid=${userID}`;
    iframe.src = url;
}

function openOfferInNewWindow(offerID, userID){
    const url = `https://www.directcpi.com/list/${offerID}?subid=${userID}`;
    window.open(url,'_blank');
}

// BitLabs
function openBitLabs() {
    if (typeof BitLabs !== 'undefined') {
        BitLabs.open();
    } else {
        alert('لوحة الاستبيانات غير جاهزة بعد، يرجى المحاولة مرة أخرى.');
    }
}
</script>
