<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Game Task — عروض الاستبيانات</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDuQsN4n3In6arYu0wkw9gC...", // المفتاح الخاص بك
      authDomain: "mytasktracker-59e00.firebaseapp.com",
      projectId: "mytasktracker-59e00",
      storageBucket: "mytasktracker-59e00.appspot.com",
      messagingSenderId: "433007982533",
      appId: "1:433007982533:web:99e74c7fa4f0c401d77a06",
      measurementId: "G-RDZB0YQJNP"
    };

    // تهيئة Firebase وتجهيز قاعدة البيانات
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(); 
    const usersCollection = db.collection('users'); // تعريف مجموعة البيانات
</script>
<style>
/* -------------------------------------- */
/* الأنماط الأساسية (CSS) - لم يتم تعديلها */
/* -------------------------------------- */
:root{
  --bg:#0b1220; --card:#071227; --accent:#06b6d4; --muted:#94a3b8; --gold:#d4af37;
}
*{box-sizing:border-box;font-family:"Segoe UI",Tahoma,"Noto Kufi Arabic",system-ui,sans-serif;}
body{margin:0;background:linear-gradient(180deg,#071127 0%, #071a2a 100%);color:#e6eef6;padding:20px;}
header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:18px;}
.brand{display:flex;align-items:center;gap:12px;}
.logo{width:54px;height:54px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#0891b2);display:flex;align-items:center;justify-content:center;font-weight:700;}
h1{margin:0;font-size:20px;}
p.lead{margin:0;color:var(--muted);font-size:13px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:18px;}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:10px;min-height:160px;transition:transform 0.2s,box-shadow 0.2s;cursor:pointer;}
.card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.4);}
.title{font-weight:700;font-size:16px;}
.desc{color:var(--muted);font-size:13px;}
.meta{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:auto;}
.btn{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700;}
.open-btn{background:linear-gradient(90deg,var(--accent),#0891b2);color:#022;text-decoration:none;display:inline-block;text-align:center;width:100%;}
.gold-card{background:linear-gradient(180deg,rgba(212,175,55,0.2),rgba(212,175,55,0.1));border:1px solid rgba(212,175,55,0.6);}
.gold-card .title{color:var(--gold);}
.gold-card .counter{font-size:14px;color:var(--gold);font-weight:700;margin-bottom:10px;}
footer{margin-top:22px;color:var(--muted);font-size:13px;text-align:center;}
.section-title{font-size:18px;font-weight:700;margin-bottom:10px;color:var(--accent);}
.subgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;}
.external-complete-btn {
    background-color: #4CAF50 !important; 
    color: #022 !important;
}
.survey-content {
    display: none;
    padding: 10px;
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-top: 10px;
}
.survey-card {
    cursor: pointer;
    background: linear-gradient(180deg, rgba(6,182,212,0.1), rgba(6,182,212,0.05));
    border-color: rgba(6,182,212,0.3);
}
.survey-progress {
    color: var(--gold);
    font-weight: 700;
    margin-bottom: 10px;
}
/* تنسيق خاص لبطاقة التضمين (لجعلها أكبر) */
.embed-card {
    /* تجعل البطاقة تأخذ مساحة أكبر في عرض subgrid */
    grid-column: span 2; 
    min-height: 450px !important;
    padding: 0; 
    overflow: hidden;
    cursor: default; /* تعطيل مؤشر النقر */
}
.embed-card iframe {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 12px;
}

input, textarea{width:100%;padding:8px;border-radius:6px;border:none;margin-bottom:10px;}
button.send-btn{background:var(--accent);color:#022;padding:10px;border-radius:8px;border:0;cursor:pointer;font-weight:700;width:100%;}
</style>
</head>
<body>

<div id="auth-section">
    <h1>تسجيل/دخول المستخدم</h1>
    <label for="username">أدخل اسمك:</label><br>
    <input type="text" id="username" placeholder="الاسم الذي ستستخدمه"><br><br>
    <button onclick="handleAuth()">دخول / تسجيل فوري</button>
    <p id="message" style="color: yellow;"></p>
</div>

<div id="dashboard-section" style="
    display:none; 
    padding: 15px; 
    background-color: #0b1220; 
    border-bottom: 2px solid #071227;
    margin-bottom: 20px;
    color: white;
">
    <h3 id="user-display" style="margin: 0;"></h3>
</div>

<main id="main-content" style="display:none;">
    <header>
      <div class="brand">
        <div class="logo">GT</div>
        <div>
          <h1>Game Task — عروض الاستبيانات</h1>
          <p class="lead">اختر العرض واضغط "اذهب" لفتح الموقع وسيتم تسجيل رابط الإحالة مباشرة.</p>
        </div>
      </div>
    </header>

    <a href="dynamic_task_list.html" style="text-decoration: none;"> 
        <div class="card gold-card" id="goldCard" style="display:flex;">
            <div class="title">مهام اليوم</div>
            <div class="counter" id="pointsCounter">النقاط: 0</div>
            <div class="meta" style="margin-top: 10px;">
                <span class="btn open-btn" style="width: 100%; text-align: center;">انتقل للمهام اليومية</span>
            </div>
        </div>
    </a>
    
    <div style="margin-bottom:20px; text-align:center;">
      <p style="color:var(--muted);">إعلان Google</p>
    </div>

    <div class="grid" id="cardsGrid">
      <div class="card">
        <div class="title">Freecash — استبيانات ومهام</div>
        <div class="desc">اكمل عروض واستبيانات واحصل على نقاط.</div>
        <div class="meta">
          <a class="btn open-btn" href="https://freecash.com/r/ST6JL" target="_blank" rel="noopener noreferrer">اذهب</a>
        </div>
      </div>
      <div class="card">
        <div class="title">PrizeRebel — استبيانات ومهام</div>
        <div class="desc">سجل وابدأ بالعروض؛ غالبًا تعطي نقاط جيدة.</div>
        <div class="meta">
          <a class="btn open-btn" href="https://www.prizerebel.com/index.php?r=16156361" target="_blank" rel="noopener noreferrer">اذهب</a>
        </div>
      </div>
      <div class="card">
        <div class="title">TimeBucks — مهام وسرعات</div>
        <div class="desc">مهام مختلفة: مشاهدة، تسجيل، أفكار سريعة.</div>
        <div class="meta">
          <a class="btn open-btn" href="https://timebucks.com/?refID=227024124" target="_blank" rel="noopener noreferrer">اذهب</a>
        </div>
      </div>
      <div class="card">
        <div class="title">GemsLoot — عروض وكسب</div>
        <div class="desc">عروض وربح عبر تحميل وتجربة — رابط إحالة.</div>
        <div class="meta">
          <a class="btn open-btn" href="https://gemsloot.com/?aff=" target="_blank" rel="noopener noreferrer">اذهب</a>
        </div>
      </div>
      <div class="card">
        <div class="title">Idle-Empire — مهام وألعاب</div>
        <div class="desc">من أشهر مواقع المهام والاستبيانات.</div>
        <div class="meta">
          <a class="btn open-btn" href="https://www.idle-empire.com?r=fofsqy" target="_blank" rel="noopener noreferrer">اذهب</a>
        </div>
      </div>
    </div>
    
    <div style="margin-top:30px;">
      <h2 class="section-title">من نحن</h2>
      <p style="color:var(--muted);">Game Task هو موقع يقدم الاستبيانات والمهمات لجميع الزوار، مع نظام نقاط متكامل لمكافأة المستخدمين على نشاطهم. هدفنا هو تقديم محتوى متنوع وممتع يجمع بين التعلم والترفيه.</p>
    </div>

    <div style="margin-top:20px;">
      <h2 class="section-title">اتصل بنا</h2>
      <form id="contactForm">
        <input type="text" placeholder="الاسم" required>
        <input type="email" placeholder="البريد الإلكتروني" required>
        <textarea placeholder="رسالتك" rows="4" required></textarea>
        <button type="submit" class="send-btn">إرسال</button>
      </form>
    </div>
</main>


<footer>
  ملاحظة: يمكنك إضافة كود Google AdSense في الأماكن المخصصة للإعلانات.
</footer>

<script>
  // أكواد الجافاسكريبت المتبقية
  document.getElementById('contactForm').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('تم إرسال رسالتك بنجاح!');
    this.reset();
  });
</script>

<script>
    // الدالة المسؤولة عن التسجيل أو الدخول
    async function handleAuth() {
        const usernameInput = document.getElementById('username').value.trim();
        const messageElement = document.getElementById('message');
        
        if (!usernameInput) {
            messageElement.textContent = "الرجاء إدخال الاسم.";
            return;
        }

        // 1. البحث عن المستخدم بالاسم
        const querySnapshot = await usersCollection.where('username', '==', usernameInput).get();

        if (querySnapshot.empty) {
            // --- (أ) مستخدم جديد: تسجيل فوري ---
            try {
                const newUserRef = await usersCollection.add({
                    username: usernameInput,
                    points: 0
                });
                const newUserId = newUserRef.id; 
                // حفظ الآيدي في المتصفح
                localStorage.setItem('user_id', newUserId); 
                displayDashboard(usernameInput, newUserId, 0);
                messageElement.textContent = `تم تسجيلك بنجاح! الآيدي الخاص بك هو: ${newUserId}`;
            } catch (error) {
                messageElement.textContent = "خطأ في التسجيل.";
            }
        } else {
            // --- (ب) مستخدم عائد: تسجيل دخول ---
            const userData = querySnapshot.docs[0].data();
            const userId = querySnapshot.docs[0].id;
            // حفظ الآيدي في المتصفح
            localStorage.setItem('user_id', userId); 
            displayDashboard(userData.username, userId, userData.points);
            messageElement.textContent = `مرحباً بك مجدداً يا ${userData.username}`;
        }
    }

    // دالة لعرض شاشة المهام والآيدي
    function displayDashboard(username, userId, points) {
        // إخفاء حقول الدخول
        document.getElementById('auth-section').style.display = 'none';
        // إظهار شريط عرض الآيدي
        document.getElementById('dashboard-section').style.display = 'block';
        
        // إظهار محتوى الموقع الأساسي
        document.getElementById('main-content').style.display = 'block'; 
        
        // تحديث بيانات المستخدم في الشريط
        const userDisplay = document.getElementById('user-display');
        userDisplay.innerHTML = `مرحباً يا ${username} | <b>آيدي المستخدم: ${userId}</b> | النقاط: ${points}`;
        
        // تحديث النقاط في البطاقة الذهبية
        const pointsCounter = document.getElementById('pointsCounter');
        if (pointsCounter) {
            pointsCounter.textContent = `النقاط: ${points}`;
        }
    }
    
    // الدخول التلقائي: التحقق من الآيدي المحفوظ عند تحميل الصفحة
    window.onload = function() {
        const storedUserId = localStorage.getItem('user_id');
        if (storedUserId) {
            usersCollection.doc(storedUserId).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    displayDashboard(userData.username, storedUserId, userData.points);
                } else {
                    document.getElementById('auth-section').style.display = 'block';
                }
            }).catch(error => {
                document.getElementById('auth-section').style.display = 'block';
                console.error("خطأ في الدخول التلقائي:", error);
            });
        } else {
            document.getElementById('auth-section').style.display = 'block';
        }
    }
</script>
</body>
</html>
