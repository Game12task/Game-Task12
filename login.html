<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل الدخول / التسجيل</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; color: #333; margin:0; padding:20px; text-align:center;}
        .login-container { max-width: 400px; margin: 50px auto; padding: 30px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);}
        h2 { color: #007bff; margin-bottom: 25px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px;}
        input[type="text"] { 
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; 
            border-radius: 6px; box-sizing: border-box; font-size: 16px; 
            text-align: right; 
        }
        button { 
            background-color: #28a745; color: white; padding: 12px 20px; 
            border: none; border-radius: 6px; cursor: pointer; 
            width: 100%; margin-top: 15px; font-size: 16px; font-weight: bold; 
            transition: background-color 0.3s;
        }
        button:hover { background-color: #1e7e34;}
        #message { margin-top: 20px; font-weight: bold;}
        .switch-mode { margin-top: 20px; font-size: 0.9em; cursor: pointer; color: #007bff;}
    </style>
    <script src="auth_handler.js"></script> 
</head>
<body>

<div class="login-container">
    <h2>تسجيل الدخول</h2>
    
    <input type="text" id="username" placeholder="اسم المستخدم (Username)">
    
    <button id="auth-btn">تسجيل الدخول</button>
    
    <p id="message"></p>
    
    <p class="switch-mode" id="switch-link">هل ليس لديك حساب؟ اضغط للتسجيل</p>
</div>

<script>
    // ** 1. التحقق من حالة الدخول فور تحميل الصفحة **
    // إذا كان المستخدم لديه ID بالفعل، سيتم توجيهه إلى index.html
    checkAuthAndRedirect();

    const usernameInput = document.getElementById('username');
    const authBtn = document.getElementById('auth-btn');
    const messageDisplay = document.getElementById('message');
    const switchLink = document.getElementById('switch-link');
    
    // الحالة الافتراضية: تسجيل الدخول
    let isRegisterMode = false;

    // ** 2. وظيفة تبديل الوضع (تسجيل دخول / تسجيل) **
    switchLink.addEventListener('click', () => {
        isRegisterMode = !isRegisterMode;
        messageDisplay.textContent = ''; // مسح الرسالة
        
        if (isRegisterMode) {
            document.querySelector('h2').textContent = 'إنشاء حساب جديد';
            authBtn.textContent = 'إنشاء حساب وتسجيل الدخول';
            authBtn.style.backgroundColor = '#dc3545'; // لون مختلف للتسجيل
            switchLink.textContent = 'لديك حساب بالفعل؟ اضغط لتسجيل الدخول';
        } else {
            document.querySelector('h2').textContent = 'تسجيل الدخول';
            authBtn.textContent = 'تسجيل الدخول';
            authBtn.style.backgroundColor = '#28a745'; // لون الدخول
            switchLink.textContent = 'هل ليس لديك حساب؟ اضغط للتسجيل';
        }
    });

    // ** 3. وظيفة الضغط على الزر **
    authBtn.addEventListener('click', async () => {
        const name = usernameInput.value.trim();
        let result;

        messageDisplay.textContent = 'جاري المعالجة...';

        if (isRegisterMode) {
            // تنفيذ وظيفة التسجيل من auth_handler.js
            result = await registerUser(name);
        } else {
            // تنفيذ وظيفة تسجيل الدخول من auth_handler.js
            result = await loginUser(name);
        }

        messageDisplay.textContent = result.message;
        messageDisplay.style.color = result.status === 'success' ? '#28a745' : '#dc3545';
        
        // إذا كان نجاح، سيقوم registerUser/loginUser بالتوجيه إلى index.html
    });

    // لتبسيط العملية: يمكن للمستخدم الضغط على Enter
    usernameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            authBtn.click();
        }
    });
</script>

</body>
</html>
