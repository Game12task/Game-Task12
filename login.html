<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل الدخول / التسجيل</title>
    <style>
        /* (كود الـ CSS لم يتغير) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; color: #333; margin:0; padding:20px; text-align:center;}
        .login-container { max-width: 400px; margin: 50px auto; padding: 30px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);}
        h2 { color: #007bff; margin-bottom: 25px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px;}
        input[type="email"], input[type="password"] { /* تم تعديل هذا السلكتور */
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; 
            border-radius: 6px; box-sizing: border-box; font-size: 16px; 
            text-align: right; 
        }
        button { 
            background-color: #28a745; color: white; padding: 12px 20px; 
            border: none; border-radius: 6px; cursor: pointer; 
            width: 100%; margin-top: 15px; font-size: 16px; font-weight: bold; 
            transition: background-color 0.3s;
        }
        button:hover { background-color: #1e7e34;}
        #message { margin-top: 20px; font-weight: bold;}
        .switch-mode { margin-top: 20px; font-size: 0.9em; cursor: pointer; color: #007bff;}
    </style>
    <script src="firebase_config.js"></script> 
    <script src="auth_handler.js"></script> 
</head>
<body>

<div class="login-container">
    <h2>تسجيل الدخول</h2>
    
    <input type="email" id="authEmail" placeholder="البريد الإلكتروني (Email)" required> 
    
    <input type="password" id="authPassword" placeholder="كلمة المرور (Password)" required>

    <button id="auth-btn">تسجيل الدخول</button>
    
    <p id="message"></p>
    
    <p class="switch-mode" id="switch-link">هل ليس لديك حساب؟ اضغط للتسجيل</p>
</div>

<script>
    // ** 0. الدوال المضافة في auth_handler.js تحتاج إلى جلبها من الملف الآخر **
    // هنا يجب أن نستخدم دالة checkAuthState التي جهزناها في الملف الآخر
    // checkAuthState(true); // نضمن الحماية هنا

    const emailInput = document.getElementById('authEmail');
    const passwordInput = document.getElementById('authPassword');
    const authBtn = document.getElementById('auth-btn');
    const switchLink = document.getElementById('switch-link');
    const messageDisplay = document.getElementById('message');
    
    let isRegisterMode = false;

    // ** 1. وظيفة تبديل الوضع (تسجيل دخول / تسجيل) **
    switchLink.addEventListener('click', () => {
        isRegisterMode = !isRegisterMode;
        messageDisplay.textContent = ''; // مسح الرسالة
        
        if (isRegisterMode) {
            document.querySelector('h2').textContent = 'إنشاء حساب جديد';
            authBtn.textContent = 'إنشاء حساب جديد';
            authBtn.style.backgroundColor = '#dc3545';
            switchLink.textContent = 'لديك حساب بالفعل؟ اضغط لتسجيل الدخول';
        } else {
            document.querySelector('h2').textContent = 'تسجيل الدخول';
            authBtn.textContent = 'تسجيل الدخول';
            authBtn.style.backgroundColor = '#28a745';
            switchLink.textContent = 'هل ليس لديك حساب؟ اضغط للتسجيل';
        }
    });

    // ** 2. وظيفة الضغط على الزر **
    authBtn.addEventListener('click', () => {
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        
        // التحقق الأساسي من الحقول
        if (!email || !password) {
            messageDisplay.textContent = 'الرجاء إدخال البريد وكلمة المرور.';
            messageDisplay.style.color = '#dc3545';
            return;
        }

        messageDisplay.textContent = 'جاري المعالجة...';

        if (isRegisterMode) {
            // استدعاء الدالة من auth_handler.js
            registerUser(email, password); 
        } else {
            // استدعاء الدالة من auth_handler.js
            loginUser(email, password);
        }
        
        // ملاحظة: دوال registerUser و loginUser في auth_handler.js هي التي تتعامل مع التوجيه وعرض رسائل النجاح/الخطأ النهائية عبر alert().
        // إذا كنت تفضل استخدام messageDisplay لعرض الرسائل، يجب تعديل الدوال في auth_handler.js لـ 'resolve/reject' بدلاً من 'alert'
    });

    // لتبسيط العملية: يمكن للمستخدم الضغط على Enter
    passwordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            authBtn.click();
        }
    });

</script>

</body>
</html>
