<script src="surveys_handler.js"></script>

<script>
    // مُعرّف الاستبيان
    const SURVEY_ID = 'quick_5q'; 

    // جلب مجموعة الأسئلة الخاصة باليوم
    let questions = [];
    const storedSet = localStorage.getItem('current_survey_set_Q5'); 
    
    if (storedSet) {
        questions = JSON.parse(storedSet);
    } else {
        alert('حدث خطأ في تحميل أسئلة الاستبيان. يرجى المحاولة مرة أخرى.');
        window.location.href = 'quick_survey_start_5q.html';
    }

    let currentQuestionIndex = 0;
    let correctAnswers = 0;

    const questionElement = document.getElementById('question');
    const answerInput = document.getElementById('answer');
    const statusMessage = document.getElementById('statusMessage');
    const questionCounter = document.getElementById('questionCounter');

    function loadQuestion() {
        if (currentQuestionIndex < questions.length) {
            questionElement.textContent = questions[currentQuestionIndex].question;
            questionCounter.textContent = `السؤال ${currentQuestionIndex + 1} من ${questions.length}`;
            answerInput.value = '';
            statusMessage.textContent = '';
        } else {
            // الاستبيان انتهى!
            const totalQuestions = questions.length;
            
            // ⭐️ تسجيل الإنجاز اليومي (الذي يمنع الإكمال مرة أخرى اليوم) ⭐️
            markSurveyCompleted(SURVEY_ID);
            
            alert(`تهانينا! أكملت الاستبيان.\nالإجابات الصحيحة: ${correctAnswers} من ${totalQuestions}`);
            window.location.href = 'index.html'; // العودة إلى الصفحة الرئيسية
        }
    }

    function checkAnswer() {
        const userAnswer = answerInput.value.trim().toLowerCase();
        const correctAnswer = questions[currentQuestionIndex].answer.trim().toLowerCase();
        
        if (userAnswer === correctAnswer) {
            statusMessage.textContent = 'إجابة صحيحة! ✅';
            statusMessage.style.color = '#4ade80'; 
            correctAnswers++;
        } else {
            statusMessage.textContent = `إجابة خاطئة. الصحيح: ${questions[currentQuestionIndex].answer} ❌`;
            statusMessage.style.color = '#f87171'; 
        }

        setTimeout(() => {
            currentQuestionIndex++;
            loadQuestion();
        }, 1500); 
    }

    // ابدأ بتحميل السؤال الأول عند فتح الصفحة
    loadQuestion();
</script>
